用ROC曲线评价分类系统的优劣_何巍_新浪博客 http://blog.sina.com.cn/s/blog_6f18d6310102webg.html

很多时候，我们会遇到目标明确的分类问题，比如一个人去医院检查是否得了某种疾病，那么他可能被分为得病和正常二种情况， 而这其中需要一个分类系统，可能是某种检验，经过这个分类系统，病人被划定为得病或者正常。那么，我们如何评价这个分类系统的准确性如何呢？

首先，要有几个概念要弄清楚: （仍以上面去医院检查为例方便理解）

TP (true positive 真阳性）： 检测认为得病了事实上也得病了，就是真阳性
FP (false positive 假阳性）： 检测认为得了病结果没得病，就是假阳性
TN(ture negative 真阴性）： 检测认为没有得病结果真没有病了，就是真阴性
FN(false negative 假阴性）： 检测认为没有得病结果却得病了，就是假阴性
TPR (true positive rate 真阳性率）： TP/(TP+FN), 又称为 sensitivity  敏感度
FPR(false positive rate 假阳性率）： FP/(FP+TN)
TNR(true negative rate 真阴性率）： TN/(TN+FP) = 1- FPR   称为 specificity 特异性

了解了以上概念之后，对于一组数据，经过分类后即可得到所有参数的值，可以得到（FPR, TPR)坐标，ROC曲线是由一些（FPR, TPR) 点绘成的一条曲线。 那么问题来了，既然一组数据经过一次分类只能得到一个（FPR,TPR) 坐标，我们怎么得到多个点呢？
 
通常我们的分类中存在一个阈值，比如某项身体指标，高于多少就是得病了，低于多少为正常。我们通过改变这个阈值，然后分类，就可以得到一些列的（FPR, TPR) 点。 这些点可以得到如下图中的曲线：
用ROC曲线评价分类系统的优劣
其中蓝色的曲线就是我们说的ROC曲线，红色的直线是 y = x 直线， 它作为reference line，ROC曲线高于这条线的部分越多，则表示该分类系统效果越好。这样，从直观上我们就能看到分类的效果到底如何了。与ROC曲线对应的AUC 值（area under curve）则从数值上反应分类的好坏。 AUC 指的是曲线以下部分的面积， 如果AUC值为1 则代表完美的分类器， AUC 等于0.5 则表示与随机分类（俗称瞎蒙）效果一样，所以有个 y= x 的直线，这个线就是0.5的标准。 一般分类在0.7到0.9之间就具有一定的分类效果了，高于0.9那么你的分类就特牛了。当然这也是结合具体情况来看的。

那么AUC 怎么去计算呢？ 用积分去求面积当然是可以的，不过有点麻烦，还有另外两种算法：

 1.一个关于AUC的很有趣的性质是，它和Wilcoxon-Mann-Witney Test是等价的。Wilcoxon-Mann-Witney Test就是测试任意给一个正类样本和一个负类样本，正类样本的score有多大的概率大于负类样本的score。有了这个定义，我们就得到了另外一中计 算AUC的办法：得到这个概率。我们知道，在有限样本中我们常用的得到概率的办法就是通过频率来估计之。这种估计随着样本规模的扩大而逐渐逼近真实值。这和上面的方法中，样本数越多，计算的AUC越准确类似，也和计算积分的时候，小区间划分的越细，计算的越准确是同样的道理。具体来说就是统计一下所有的 M×N(M为正类样本的数目，N为负类样本的数目)个正负样本对中，有多少个组中的正样本的score大于负样本的score。当二元组中正负样本的 score相等的时候，按照0.5计算。然后除以MN。实现这个方法的复杂度为O(n^2)。n为样本数（即n=M+N） 
2. 这种方法实际上和上述方法是一样的，但是复杂度减小了。它也是首先对score从大到小排序，然后令最大score对应的sample 的rank为n，第二大score对应sample的rank为n-1，以此类推。然后把所有的正类样本的rank相加，再减去M-1种两个正样本组合的情况。得到的就是所有的样本中有多少对正类样本的score大于负类样本的score。然后再除以M×N。即  
      公式解释：

        1、为了求的组合中正样本的score值大于负样本，如果所有的正样本score值都是大于负样本的，那么第一位与任意的进行组合score值都要大，我们取它的rank值为n，但是n-1中有M-1是正样例和正样例的组合这种是不在统计范围内的（为计算方便我们取n组，相应的不符合的有M个），所以要减掉，那么同理排在第二位的n-1，会有M-1个是不满足的，依次类推，故得到后面的公式M*(M+1)/2，我们可以验证在正样本score都大于负样本的假设下，AUC的值为1

      2、根据上面的解释，不难得出，rank的值代表的是能够产生score前大后小的这样的组合数，但是这里包含了（正，正）的情况，所以要减去这样的组（即排在它后面正例的个数），即可得到上面的公式

      另外，特别需要注意的是，再存在score相等的情况时，对相等score的样本，需要 赋予相同的rank(无论这个相等的score是出现在同类样本还是不同类的样本之间，都需要这样处理)。具体操作就是再把所有这些score相等的样本 的rank取平均。然后再使用上述公式。 