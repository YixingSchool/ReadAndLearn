
# 第 17 章 服务治理

* 服务治理
  * 基于服务调用的性能KPI数据进行容量管理
  * 对故障业务做服务降级、流量控制、流量迁移
  * 服务预发布流程

## 17.1 服务治理技术的历史变迁

* 历史
  * SOA Governance
    * 对企业IT系统中异构服务的质量管理、服务发布审批流程管理
    * 和服务建模、开发、测试以及运行的全生命周期管理
  * 分布式服务框架
    * 对内部同构服务的线上治理，保障线上服务的运行质量
  * 微服务架构 + 云端服务治理
    * 服务微自治，利用云调度的弹性和敏捷，逐渐消除人工治理
* SOA
  * 服务建模：验证需求，发现和评估当前服务
  * 服务组装：创建和修改服务以满足所有业务需求
  * 服务部署：功能测试、性能测试和满足度测试
  * 服务管理：在整个生命周期内管理和监控服务，跟踪服务注册表中的服务
* SOA缺点
  * 缺少服务运行时动态治理能力，面对突发的流量高峰和业务冲击
* 分布式服务框架服务治理
  * 治理定位：对内部采用统一的服务框架服务化的业务运行态
  * 治理对象：基于统一分布式服务框架开发的业务服务
  * 治理策略：服务的限流降级、服务迁入迁出、服务动态路由和灰度发布
* AWS云端微服务治理
  * 统一服务化开发环境
  * 后端应用服务化
  * 服务共享、原子化、重用
  * 小研发团队（2 Pizza Team）
  * 高度自动化和DevOps
  * 超大规模支持
  * 基于Docker容器部署微服务

## 17.2 应用服务化后面临的挑战

* 挑战
  * 多团队协作问题
  * 服务安全问题
  * 线下服务管控
  * 线上服务治理，保障服务SLA
* 跨团队协作问题
* 服务的上下线管控
  * 先标识为过时
  * 通知调用方修改调用
  * 确认无消费者调用此服务
* 服务安全
* 服务SLA保障
* 故障快速定界定位

## 17.3 服务治理

* 服务治理目标
  * 防止业务服务架构腐化：梳理不合理的依赖和调用路径，优化服务化架构
  * 快速故障定界定位：通过Flume等分布式日志采集框架
  * 微服务管控
  * 服务生命周期管理：上线审批、下线通知，在线升级
* 服务治理架构设计
  * 层次
    * 服务治理展示层
    * 服务治理SDK层
      * 服务治理元数据
      * 服务治理接口
      * 服务治理客户端类库
      * 调用示例
      * 集成开发指南
    * 后台服务治理服务层
* 运行态服务治理功能设计
  * 服务治理的可视化
  * 服务的性能KPI数据
    * 服务调用QPS
    * 服务调用时延
  * 限流规则
    * 添加限流规则后，由服务治理服务修改注册中心
    * 注册中心将流控变更信息通知到集群中
  * 流量高峰期平稳渡过可停用流控功能
  * 非核心服务不可用时，需要做业务功能放通
* 线下服务治理
  * 利用需求管理工具实现服务接口的开发迭代计划排序

## 17.4 总结

* 服务监控
  * 服务列表
  * 服务性能KPI数据
  * 服务报表
  * 服务健康度
* 线下治理
  * 开发工具
  * 仿真测试
  * 上线审批
  * 下线通知
  * 服务文档库
  * 协作流程
* 权限管理
  * 用户管理
  * 角色管理
  * 权限管理
  * 授权管理
* 线上治理
 * 服务流控
 * 优先级调度
 * 服务降级
 * 超时控制
 * 动态路由规则
 * 服务迁移
 * 故障导流
 * 服务分组