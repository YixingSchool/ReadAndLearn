

# 第 10 章 服务发布和引用

## 10.1 服务发布设计

### 10.1.1 服务发布的几种方式

* 发布方式
  * XML配置
    * 零入侵业务代码
    * 扩展和修改方便
    * 不需重新编译
  * 注解
    * 低入侵业务代码
    * 扩展和修改方便
    * 需要重新编译
  * API
    * 高入侵业务代码
    * 与具体服务框架绑定
    * 需要重新编译

### 10.1.2 本地实现类封装成代理

* 动态代理的好处
  * 无论什么服务，发布流程相似
  * 可对服务发布进行动态拦截
  * 便于扩展和替换
* 动态代理
  * JDK Proxy
  * Spring InvocationHandler
  * 字节码处理框架javassist

### 10.1.3 服务发布成指定协议

同一服务允许发布成多种协议

### 10.1.4 服务提供者信息注册

* 服务注册
  * 供消费者订阅服务地址信息进行服务路由
  * 基于服务注册中心的统一服务治理
  * 服务注册要放在服务发布的最后一个环节进行

## 10.2 服务引用设计

### 10.2.1 本地接口调用转换成远程服务调用

### 10.2.2 服务地址本地缓存

### 10.2.3 远程服务调用

## 10.3 最佳实践

### 10.3.1 对等设计原则

各种服务发布提供的功能应该是对等的

### 10.3.2 启动顺序

服务框架需支持，服务提供者、消费者、服务注册中心启动乱序

### 10.3.3 同步还是异步发布服务

异步发布服务加速系统启动

### 10.3.4 警惕网络风暴

* 网络风暴
  * 海量的变更通知占用服务无注册中心的网络带宽
  * 要素
    * 是否注册
    * 管理服务的上限
    * 网络带宽规划
    * 磁盘空间规划
    * 性能

### 10.3.5 配置扩展

* 配置扩展
  * 利用anyAttribute实现未被schema规定的属性来扩展XML文档