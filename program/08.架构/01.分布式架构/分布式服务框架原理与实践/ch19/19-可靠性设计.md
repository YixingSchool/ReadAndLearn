
# 第 19 章 可靠性设计

* 跨进程调用的故障风险
  * 链路闪断、读写超时
  * 序列化和反序列化
  * 畸形码流
  * 服务端流控和拥塞保护

## 19.1 服务状态监测

* 服务状态监测
  * 消费者需要能够实时获取服务提供者的状态
* 基于服务注册中心状态监测
  * 监测服务提供者不可用，将故障信息广播到集群所有节点
* 链路有效性状态监测机制
  * 服务注册中心监测 + 服务提供者和消费者之间的链路有效性检测双重检测

## 19.2 服务健康度检测

* 服务健康监测
  * 根据体检结果对健康度做打分，得分低的节点，路由权重会被自动调低
  * 性能KPI
    * 服务调用时延
    * 服务QPS
    * 服务调用成功率
    * CPU，内存等资源情况
  * 健康度评分通常由独立的监控节点负责

## 19.3 服务故障隔离

* 故障隔离
  * 进程级
  * VM级
  * 物理机
  * 机房
* 进程级故障隔离
  * 将服务部署到不同的线程池
* VM级故障隔离
  * 将应用部署到不同的VM中
* 物理机故障隔离
  * 非亲和性安装：即服务实例需要部署到不同的物理机上，通常至少需要3台物理机
* 机房故障隔离
  * 两个机房部署2套应用集群
  * 每个机房部署一套服务注册中心集群
  * 服务订阅和发布同时针对两个注册中心
  * 优先访问同一个机房的服务提供者

## 19.4 其他可靠性特性

* 服务注册中心
  * 采用对等集群设计
  * 本地缓存
* 监控中心
  * 失去部分采样数据
* 服务提供者
  * 尝试不同的容错恢复手段，例如FailOver容错策略
  * 整个提供者集群宕机，则利用服务放通、故障引流、容灾切换等手段
