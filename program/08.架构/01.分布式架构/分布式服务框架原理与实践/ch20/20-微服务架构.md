
# 第 20 章 微服务架构

* 微服务架构
  * SOA（Service-Oriented Architecture）
  * 微服务（Micro Service Architecture）

## 20.1 微服务架构产生的历史背景

* 历史背景
  * 传统MVC垂直架构面临挑战
* 研发成本挑战
  * 代码重复率高
    * 集成小组将各模块打包
    * 公共模块职责膨胀
    * 主要原因
      * 主要是本地API接口调用，不存在业务的拆分和互相调用
      * 开发只需要对自己开发的模块交付质量负责
      * 功能提供者的交付时间无法满足使用者
      * 跨地域、跨开发小组协调困难
  * 需求变更困难
    * 已有功能变更或新需求夹肉都会非常困难
* 运维成本高
  * 代码维护困难
  * 部署效率低
* 新需求上线周期长

## 20.2 微服务架构带来的改变

* 应用解耦
  * 基于服务注册中心的订阅发布机制，实现消费者和提供者的解耦
* 分而治之
  * 应用拆分
    * 水平拆分：以业务领域为维度
    * 垂直拆分：前后台逻辑拆分、业务逻辑和数据访问层拆分
* 敏捷交付
  * 快速进行变更的能力

## 20.3 微服务架构解析

* 微服务架构
  * 单块架构Monolithic
  * MSA
* 微服务划分原则
  * 不能以代码量作为划分微服务的维度
  * 小且专注做一件事情
* 开发微服务
  * 搭建统一的开发打包和持续集成环境
  * 微服务模板
    * 微服务描述模板文件：描述服务的接口定义、数据结构以及操作集合和参数
    * 配置文件模板
  * 自动构建流程
    * 代码静态检查
    * 代码编译构建
    * 自动化测试框架
* 基于Docker容器部署微服务
  * 快速
  * 可移植性
    * 线上线下环境等同性
    * 与特定的云提供上解耦
    * 提升运维效率
    * 敏捷性
* 治理和运维微服务
  * 挑战
    * 监控度量问题
    * 分布式运维
    * 服务注册中心的处理能力、通知的实时性
    * 微服务治理
  * 运维能力
    * 分布式性能数据采集、日志采集Agent：Flume
    * 分布式汇总和计算框架
    * 分布式文件存储服务：HDFS
    * 分布式日志检索服务：Elasticsearch
    * 分布式报表展示框架
  * 自动化
    * 将人工操作的运维工作标准化、流程化和标准化
    * 自动扩容服务
* 特点总结
  * 单一职责：SOLID原则之一
  * 独立部署、升级、扩展和替换
  * 支持异构/多种语言
  * 轻量级