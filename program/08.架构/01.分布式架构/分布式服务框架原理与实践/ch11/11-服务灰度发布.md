
# 第 11 章 服务灰度发布

## 11.1 服务灰度发布流程设计

* 环境准备
  * 对灰度环境进行划分、隔离和准备
  * 过程
    * 圈定本轮灰度发布的范围，将其保存到服务注册中心
    * 采用优雅停机方式通知范围内的服务实例下线
    * 选择需要升级的服务安装镜像包用于版本升级
    * 升级成功后，返回部署成功消息给平台
* 灰度规则设置
  * 部分用户用老的服务，部分用户用新的服务
  * 分类
    * 按照接入门户类型分类
    * 按照终端类型分类
    * 按照区域划分
  * 规则引擎
* 灰度规则下发
  * 软负载均衡器SLB
  * Web前台
  * 后台服务
  * 消息和服务路由时，通过路由插件解析灰度规则
* 灰度路由
* 失败回滚
* 灰度发布总结
  * 服务调用来源分析
  * 服务性能KPI数据
  * 用户行为分析报告
  * 用户问卷调查