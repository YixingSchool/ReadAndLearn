
# 第 16 章 服务优先级调度

## 16.1 设置服务优先级

* 服务优先级
  * 服务在发布的时候，可以指定服务的优先级
  * 服务发布XSD通过扩展priority属性的方式指定优先级
* 优先级调度策略
  * 基于线程吊斗器
  * 基于优先级队列
  * 基于加权配置
  * 基于服务迁入迁出

## 16.2 线程调度器方案

* 线程优先级
  * Thread.setPriority
  * 根据用户的优先级配置策略，将服务优先级映射到线程优先级中
  * 创建多个不同的优先级线程，分别调度对应的服务
  * 提高一个已经能够正常工作的服务的运行质量
  * 无法保证精确性和跨平台移植性

## 16.3 Java优先级队列

* Java优先队列PriorityQueue
  * 基于优先级堆的无界优先级队列
  * 优先级队列的头是按指定排序方式确定的最小元素
  * 低优先级的消息无法及时处理而超时

## 16.4 加权优先级队列

## 16.5 服务迁入迁出

* 服务迁入迁出原理
  * 系统资源紧张时，将低优先级服务的部分运行实例从注册中心迁出
  * 消费者动态发现服务，更新本地路由表，不路由到已迁出的服务实例上
  * 只迁出部分实例，被迁出的低优先级服务仍然能正常工作
  * 业务高峰结束后，重新迁入服务
