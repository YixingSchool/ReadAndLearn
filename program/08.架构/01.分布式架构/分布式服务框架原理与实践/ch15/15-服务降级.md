

# 第 15 章 服务降级

* 场景
  * 大促或业务高峰，为保证核心服务，停止不太重要的业务
  * 某些服务不可用户，流程不能直接失败，需要本地Mock服务端，做流程放行
* 服务降级
  * 容错降级
  * 屏蔽降级

## 15.1 屏蔽降级

* 屏蔽降级
  * 对非核心服务做强制降级，不发起远程服务调用，直接返回空、异常或执行特定的本地逻辑
  * 流程
    * 选择需要降级的服务，指定具体的降级策略
    * 服务注册中心接受到屏蔽降级消息后，以事件形式发给提供者和消费者
    * 消费者收到消息，更新本地缓存；发起远程服务调用，需要与降级策略匹配
    * 提供者收到消息，更新本地缓存，将服务降级
* 屏蔽降级的设计实现
 * 返回null
 * 返回异常
 * 执行本地Mock接口

## 15.2 容错降级

* 容错降级
  * 当非核心服务不可用，对故障服务做业务逻辑放通
  * 种类
    * RPC一次
    * Service异常
* 容错降级 VS 屏蔽降级
  * 触发：容错降级根据服务调用结果，自动匹配触发；屏蔽降级手工操作触发
  * 作用：容错降级是服务提供者不可用时，让消费者执行业务放通；屏蔽降级是将资源调配出来给核心业务使用
  * 调用机制：远程服务调用；本地调用
* 业务放通的Mock接口放在消费者端实现
  * 本地业务放通可能会依赖消费者本地的资源
  * 不同消费者失败处理策略不一样
* 优先级
  * 消费者配置策略 > 服务提供者配置策略
  * 屏蔽降级 > 容错降级