

# 第 7 章 集群容错

## 7.1 集群容错场景

某个服务提供者是否可用堆消费者而言无关紧要，最终的服务调用成功才是最重要的

* 通信链路故障
  * 宕机
  * 解码
  * IO
  * 心跳超时
  * 交换机异常
  * 长时间Full GC
* 服务端超时
  * IO超时
  * 服务端处理业务缓慢
  * 服务端长时间Full GC
* 服务端调用失败
  * 解码
  * 动态流控
  * 服务端消息队列超过阈值
  * 超过SLA策略

## 7.2 容错策略

* 失败自动切换（Failover）
  * 重新选择链路，查找下一个可用的服务提供者
  * 过滤上次故障服务提供者
* 失败通知（Failback）
  * 失败后不再重试其他服务提供者
  * 将异常通知给消费者，有消费者捕获异常进行后续处理
* 失败缓存（Failcache）
  * 缓存消息，等待周期定点发送到指定的服务提供者
  * 考虑要素
    * 缓存时间、缓存对象上限
    * 缓存淘汰算法
    * 重试最大次数
* 快速失败（Failfast）
  * 非核心服务，失败也不再重试
* 容错策略扩展
  * 开发容错接口
  * 屏蔽底层细节
  * 让用户扩展服务框架Schema